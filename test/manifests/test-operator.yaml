apiVersion: kudo.dev/v1beta1
kind: Operator
metadata:
  name: test-operator
  namespace: default
spec:
  maintainers:
    - name: KUDO
      email: kudobuilder@gmail.com
---
apiVersion: kudo.dev/v1beta1
kind: OperatorVersion
metadata:
  name: test-operator-1.0
  namespace: default
spec:
  operator:
    name: test-operator
    kind: Operator
  version: "1.0"
  parameters:
  - name: REPLICAS
    description: "Number of nginx replicas"
    default: "3"
    displayName: "Replica count"
  - name: PARAM
    description: "Sample parameter"
    default: "before"
  templates:
    deploy.yaml: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: nginx
      spec:
        replicas: {{ .Params.REPLICAS }}
        selector:
          matchLabels:
            app: nginx
        template:
          metadata:
            labels:
              app: nginx
          spec:
            containers:
            - name: nginx
              image: nginx:1.7.9
              ports:
              - containerPort: 80
              env:
              - name: PARAM_ENV
                value: {{ .Params.PARAM }}
  tasks:
    - name: deploy
      kind: Apply
      spec:
        resources:
          - deploy.yaml
  plans:
    deploy:
      strategy: serial
      phases:
      - name: deploy
        strategy: parallel
        steps:
        - name: deploy
          tasks:
          - deploy
